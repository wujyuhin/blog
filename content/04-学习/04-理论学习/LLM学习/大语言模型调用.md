# 阿里云灵积服务
## 位置
工作台 -搜索模型服务灵积-申请自己的 api

## 安装 dashscope sdk
```shell
pip install dashscope
```
## 设置 api
### 1.通过环境变量设置
```bash
export DASHSCOPE_API_KEY="YOUR_DASHSCOPE_API_KEY"
```
### 2. 代码设置
```python
import dashscope
dashscope.api_key="YOUR_DASHSCOPE_API_KEY"
```

### 3. 文件设置
```bash
export DASHSCOPE_API_KEY_FILE_PATH=YOUR_API_KEY_FILE_PATH
```


## 快速开始
### 1.通过 message 调用
```python
# For prerequisites running the following sample, visit https://help.aliyun.com/document_detail/611472.html
from http import HTTPStatus
import dashscope
dashscope.api_key="sk-1cce801037ca4a88b734f2823d1fcdad"


def call_with_messages():
    messages = [{'role': 'system', 'content': 'You are a helpful assistant.'},
                {'role': 'user', 'content': '如何做炒西红柿鸡蛋？'}]

    response = dashscope.Generation.call(
        dashscope.Generation.Models.qwen_turbo,
        messages=messages,
        result_format='message',  # set the result to be "message" format.
    )
    if response.status_code == HTTPStatus.OK:
        print(response)
    else:
        print('Request id: %s, Status code: %s, error code: %s, error message: %s' % (
            response.request_id, response.status_code,
            response.code, response.message
        ))


if __name__ == '__main__':
    call_with_messages()
```


### 2. 通过 prompt 调用
```python
# For prerequisites running the following sample, visit https://help.aliyun.com/document_detail/611472.html
from http import HTTPStatus
import dashscope


def call_with_prompt():
    response = dashscope.Generation.call(
        model=dashscope.Generation.Models.qwen_turbo,
        prompt='如何做炒西红柿鸡蛋？'
    )
    # The response status_code is HTTPStatus.OK indicate success,
    # otherwise indicate request is failed, you can get error code
    # and message from code and message.
    if response.status_code == HTTPStatus.OK:
        print(response.output)  # The output text
        print(response.usage)  # The usage information
    else:
        print(response.code)  # The error code.
        print(response.message)  # The error message.

if __name__ == '__main__':
    call_with_prompt()
```



# token 计算
![[Pasted image 20240407210523.png]]